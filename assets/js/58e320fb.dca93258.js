"use strict";(self.webpackChunkresium_docs=self.webpackChunkresium_docs||[]).push([[9638],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=r.createContext({}),m=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=m(e.components);return r.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=m(t),d=i,f=u["".concat(l,".").concat(d)]||u[d]||c[d]||o;return t?r.createElement(f,a(a({ref:n},p),{},{components:t})):r.createElement(f,a({ref:n},p))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var m=2;m<o;m++)a[m]=t[m];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},477:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return m},toc:function(){return p},default:function(){return u}});var r=t(7462),i=t(3366),o=(t(7294),t(3905)),a=["components"],s={id:"guide",title:"Guide"},l="Guide",m={unversionedId:"guide",id:"guide",isDocsHomePage:!1,title:"Guide",description:"Component Lifecycle",source:"@site/docs/03-guide.md",sourceDirName:".",slug:"/guide",permalink:"/guide",editUrl:"https://github.com/reearth/resium/edit/master/docs/docs/03-guide.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"guide",title:"Guide"},sidebar:"docs",previous:{title:"Getting Started",permalink:"/getting_started"},next:{title:"Billboard",permalink:"/components/Billboard"}},p=[{value:"Component Lifecycle",id:"component-lifecycle",children:[]},{value:"Context and component availability",id:"context-and-component-availability",children:[]},{value:"Component location",id:"component-location",children:[]},{value:"Properties",id:"properties",children:[{value:"Cesium properties",id:"cesium-properties",children:[]},{value:"Cesium read-only properties",id:"cesium-read-only-properties",children:[]},{value:"Cesium events",id:"cesium-events",children:[]},{value:"Other properties",id:"other-properties",children:[]}]},{value:"Accessing to a raw Cesium&#39;s element",id:"accessing-to-a-raw-cesiums-element",children:[{value:"Way 1: useRef hooks (function component)",id:"way-1-useref-hooks-function-component",children:[]},{value:"Way 2: use a function (class component)",id:"way-2-use-a-function-class-component",children:[]},{value:"Way 3: use createRef (class component)",id:"way-3-use-createref-class-component",children:[]}]},{value:"Limitations",id:"limitations",children:[]}],c={toc:p};function u(e){var n=e.components,t=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"guide"},"Guide"),(0,o.kt)("h2",{id:"component-lifecycle"},"Component Lifecycle"),(0,o.kt)("p",null,"Resium brings React's component lifecycle to Cesium. The relationship between Cesium elements and React's lifecycle is as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Render: Nothing is rendered, as a cesium element is not initialized yet."),(0,o.kt)("li",{parentName:"ol"},"Initalize Cesium element: An Cesium element is initialized, and it is added to its parent if the parent exists."),(0,o.kt)("li",{parentName:"ol"},"Re-render: After Cesium element's initalization, children of the component are rendered. DOM never be rendered except root components (Viewer and CesiumWidget)."),(0,o.kt)("li",{parentName:"ol"},'Update: Changed properties of the Cesium element are updated. If "Cesium read-only properties" are changed, the Cesium element will be reinitialized.'),(0,o.kt)("li",{parentName:"ol"},"Unmount: The Cesium element is destroyed.")),(0,o.kt)("h2",{id:"context-and-component-availability"},"Context and component availability"),(0,o.kt)("p",null,"Some components provide some Cesium elements to children via React's context API. Many components use the closest component's context. If the context does not exists, components are not rendered."),(0,o.kt)("p",null,"All components except root components have to be mounted inside root components. Root components are ",(0,o.kt)("inlineCode",{parentName:"p"},"Viewer")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"CesiumWidget"),"."),(0,o.kt)("p",null,"For example:"),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"Entity")," component is mounted under ",(0,o.kt)("inlineCode",{parentName:"p"},"Viewer")," component, an Entity object is added to ",(0,o.kt)("inlineCode",{parentName:"p"},"Viewer#entities"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"<Viewer>\n  <Entity />\n</Viewer>\n")),(0,o.kt)("p",null,"is equivalent to"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const viewer = new Cesium.Viewer();\nconst entity = new Cesium.Entity();\n\nviewer.entities.add(entity);\n")),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"Entity")," component is mounted under ",(0,o.kt)("inlineCode",{parentName:"p"},"CustomDataSource")," component, an Entity object is added to ",(0,o.kt)("inlineCode",{parentName:"p"},"CustomDataSource#entities"),". At that time, the CustomDataSource object is added to ",(0,o.kt)("inlineCode",{parentName:"p"},"Viewer#dataSources"),". Of course ",(0,o.kt)("inlineCode",{parentName:"p"},"CustomDataSource")," component should be under ",(0,o.kt)("inlineCode",{parentName:"p"},"Viewer")," component."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"<Viewer>\n  <CustomDataSource>\n    <Entity />\n  </CustomDataSource>\n</Viewer>\n")),(0,o.kt)("p",null,"is equivalent to"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const viewer = new Cesium.Viewer();\nconst dataSource = new Cesium.CustomDataSource();\nconst entity = new Cesium.Entity();\n\ncustomDataSource.entities.add(entity);\nviewer.dataSources.add(dataSource);\n")),(0,o.kt)("p",null,'Such cases are also in other components. For details, refer to "Availability" in the document of each component.'),(0,o.kt)("h2",{id:"component-location"},"Component location"),(0,o.kt)("p",null,"Please place each component as close as possible under Viewer or CesiumWidget component to avoid extra rendering. Make component hierarchy shallow as possible."),(0,o.kt)("p",null,"Exception are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Entity")," > ",(0,o.kt)("inlineCode",{parentName:"li"},"*Graphics")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Entity")," > ",(0,o.kt)("inlineCode",{parentName:"li"},"EntityDescription")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ScreenSpaceEventHandler")," > ",(0,o.kt)("inlineCode",{parentName:"li"},"ScreenSpaceEvent")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"xCollection")," > ",(0,o.kt)("inlineCode",{parentName:"li"},"x")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"CustomDataSource")," > ",(0,o.kt)("inlineCode",{parentName:"li"},"Entity")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GroundPrimitiveCollection")," > ",(0,o.kt)("inlineCode",{parentName:"li"},"GroundPrimitive"))),(0,o.kt)("p",null,"e.g.: ",(0,o.kt)("inlineCode",{parentName:"p"},"Scene")," > ",(0,o.kt)("inlineCode",{parentName:"p"},"Camera")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"Camera")," > ",(0,o.kt)("inlineCode",{parentName:"p"},"Entity")," is not recommended."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"// not recomended\n<Viewer>\n  <Scene>\n    <Camera>\n      <Entity />\n    </Camera>\n  </Scene>\n</Viewer>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"// recomended\n<Viewer>\n  <Scene />\n  <Camera />\n  <Entity />\n</Viewer>\n")),(0,o.kt)("h2",{id:"properties"},"Properties"),(0,o.kt)("p",null,"Each components of resium have 4 kinds of properties as bellow."),(0,o.kt)("h3",{id:"cesium-properties"},"Cesium properties"),(0,o.kt)("p",null,'"Cesium property" is a property derived from Cesium. Each properties are correspond to a property of the cesium element. All "cesium properties" are variable, so when they are updated in React component, the corresponding properties will be updated seamlessly.'),(0,o.kt)("h3",{id:"cesium-read-only-properties"},"Cesium read-only properties"),(0,o.kt)("p",null,'"Cesium read-only property" is also a property derived from Cesium, but it is immutable. They are available only when initializing the element.'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},'If "Cesium read-only props" are changed in React component, the Cesium element will be destroyed and reinitialized.')," It can be a cause of performance deterioration. Please use carefully to avoid changing as much as possible."),(0,o.kt)("p",null,"For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"imageryProvider")," property of ",(0,o.kt)("inlineCode",{parentName:"p"},"ImageryLayer"),' component is a "Cesium read-only property". So in the following code, ImageryLayer is reinitialized in every rendering time!'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const Example = () => (\n  <Viewer>\n    <ImageryLayer\n      imageryProvider={\n        new ArcGisMapServerImageryProvider({\n          url: "//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",\n        })\n      }\n    />\n  </Viewer>\n);\n')),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"imageryProvider")," property is constant, The following is recommended."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React from "react";\nimport { Viewer, ImageryLayer } from "resium";\nimport { ArcGisMapServerImageryProvider } from "cesium";\n\nconst imageryProvider = new ArcGisMapServerImageryProvider({\n  url: "//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",\n});\n\nconst ExampleComponent = () => (\n  <Viewer>\n    <ImageryLayer imageryProvider={imageryProvider} />\n  </Viewer>\n);\n')),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"imageryProvider")," property is variable, use ",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," hooks:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React, { useMemo } from "react";\nimport { Viewer, ImageryLayer } from "resium";\nimport { ArcGisMapServerImageryProvider } from "cesium";\n\nconst ExampleComponent = ({ url }) => {\n  const imageryProvider = useMemo(() => new ArcGisMapServerImageryProvider({ url }), [url]);\n\n  return (\n    <Viewer>\n      <ImageryLayer imageryProvider={imageryProvider} />\n    </Viewer>\n  );\n};\n')),(0,o.kt)("h3",{id:"cesium-events"},"Cesium events"),(0,o.kt)("p",null,'"Cesium event" is a event propery of Cesium element. It can be used in the same way as normal React component events.'),(0,o.kt)("p",null,"They are renamed according to React's custom. For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"Viewer#trackedEntityChanged")," => ",(0,o.kt)("inlineCode",{parentName:"p"},"onTrackedEntityChange"),"."),(0,o.kt)("h3",{id:"other-properties"},"Other properties"),(0,o.kt)("p",null,"Some components have convenient properties that do not exist in the Cesium element. They can be used in the same way as normal React component properties."),(0,o.kt)("h2",{id:"accessing-to-a-raw-cesiums-element"},"Accessing to a raw Cesium's element"),(0,o.kt)("p",null,"If you want to access a raw Cesium's element, you cab use ",(0,o.kt)("inlineCode",{parentName:"p"},"ref")," prop of components. It can be get by ",(0,o.kt)("inlineCode",{parentName:"p"},"cesiumElement")," property of the component object that can be get by them."),(0,o.kt)("p",null,'To know what is a Cesium element of each component, refer to "Cesium element" in the document of each component.'),(0,o.kt)("p",null,"Note: ",(0,o.kt)("inlineCode",{parentName:"p"},"cesiumElement")," property in the ref object can be ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined"),": e.g. when an initialization error is occurred. Please check if it's not ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined")," when using ",(0,o.kt)("inlineCode",{parentName:"p"},"cesiumElement"),"."),(0,o.kt)("h3",{id:"way-1-useref-hooks-function-component"},"Way 1: useRef hooks (function component)"),(0,o.kt)("p",null,"Function component:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React, { useEffect, useRef } from "react";\nimport { Viewer } from "resium";\n\nconst ExampleComponent = () => {\n  const ref = useRef(null);\n\n  useEffect(() => {\n    if (ref.current && ref.current.cesiumElement) {\n      // ref.current.cesiumElement is Cesium\'s Viewer\n      // DO SOMETHING\n    }\n  }, []);\n\n  return <Viewer ref={ref} />;\n};\n')),(0,o.kt)("p",null,"Function component in TypeScript:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import React, { useEffect, useRef } from "react";\nimport { Viewer as CesiumViewer } from "cesium";\nimport { Viewer, CesiumComponentRef } from "resium";\n\nconst ExampleComponent = () => {\n  const ref = useRef<CesiumComponentRef<CesiumViewer>>(null);\n\n  useEffect(() => {\n    if (ref.current?.cesiumElement) {\n      // ref.current.cesiumElement is Cesium\'s Viewer\n      // DO SOMETHING\n    }\n  }, []);\n\n  return <Viewer ref={ref} />;\n};\n')),(0,o.kt)("h3",{id:"way-2-use-a-function-class-component"},"Way 2: use a function (class component)"),(0,o.kt)("p",null,"Class component:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React, { Component } from "react";\nimport { Viewer } from "resium";\n\nclass ExampleComponent extends Component {\n  componentDidMount() {\n    if (this.viewer) {\n      // this.viewer is Cesium\'s Viewer\n      // DO SOMETHING\n    }\n  }\n\n  render() {\n    return (\n      <Viewer\n        ref={e => {\n          this.viewer = e ? e.cesiumElement : undefined;\n        }}\n      />\n    );\n  }\n}\n')),(0,o.kt)("p",null,"Class component in TypeScript:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import React, { Component } from "react";\nimport { Viewer as CesiumViewer } from "cesium";\nimport { Viewer } from "resium";\n\nclass ExampleComponent extends Component {\n  private viewer: CesiumViewer | undefined;\n\n  componentDidMount() {\n    if (this.viewer) {\n      // this.viewer is Cesium\'s Viewer\n      // DO SOMETHING\n    }\n  }\n\n  render() {\n    return (\n      <Viewer\n        ref={e => {\n          this.viewer = e ? e.cesiumElement : undefined;\n        }}\n      />\n    );\n  }\n}\n')),(0,o.kt)("h3",{id:"way-3-use-createref-class-component"},"Way 3: use createRef (class component)"),(0,o.kt)("p",null,"Class component:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React, { Component, createRef } from "react";\nimport { Viewer } from "resium";\n\nclass ExampleComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.ref = createRef();\n  }\n\n  componentDidMount() {\n    if (this.ref.current && this.ref.current.cesiumElement) {\n      // this.ref.current.cesiumElement is Cesium\'s Viewer\n      // DO SOMETHING\n    }\n  }\n\n  render() {\n    return <Viewer ref={this.ref} />;\n  }\n}\n')),(0,o.kt)("p",null,"Class component in TypeScript:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import React, { Component, createRef } from "react";\nimport { Viewer as CesiumViewer } from "cesium";\nimport { Viewer } from "resium";\n\nclass ExampleComponent extends Component {\n  private ref = createRef<CesiumViewer | undefined>();\n\n  componentDidMount() {\n    if (this.ref.current?.cesiumElement) {\n      // this.ref.current.cesiumElement is Cesium\'s Viewer\n      // DO SOMETHING\n    }\n  }\n\n  render() {\n    return <Viewer ref={this.ref} />;\n  }\n}\n')),(0,o.kt)("h2",{id:"limitations"},"Limitations"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Server side rendering is not supported. Cesium can be rendered only in web browsers."),(0,o.kt)("li",{parentName:"ul"},"React Native is not supported. Resium runs only with ",(0,o.kt)("inlineCode",{parentName:"li"},"react-dom"),", as Cesium depends on APIs of web browsers (DOM, WebGL, Web Worker and so on).")))}u.isMDXComponent=!0}}]);